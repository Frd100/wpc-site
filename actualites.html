<!DOCTYPE html>
<html lang="fr-FR" dir="ltr">

<head>
    <meta http-equiv="content-type" content="text/html" charset="UTF-8">
    <meta http-equiv="content-encoding" content="text/html">
    <meta charset="utf-8" class="chrome">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="content-language" content="fr-FR">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- WPC Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://westparisconsulting.fr/actualites.html">
    <meta property="og:title" content="Actualités - West Paris Consulting">
    <meta property="og:description"
        content="Découvrez les dernières actualités et événements de West Paris Consulting. Restez informé de nos projets et initiatives étudiantes.">
    <meta property="og:site_name" content="WPC">
    <meta property="og:image" content="herosection.webp">
    <meta property="og:locale" content="fr_FR">

    <meta property="twitter:url" content="https://westparisconsulting.fr/actualites.html">
    <meta property="twitter:title" content="Actualités - West Paris Consulting">
    <meta property="twitter:description"
        content="Découvrez les dernières actualités et événements de West Paris Consulting. Restez informé de nos projets et initiatives étudiantes.">
    <meta property="twitter:creator" content="@WestParisConsulting">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:image" content="herosection.webp">

    <title>Actualités - West Paris Consulting</title>
    <meta name="description"
        content="Découvrez les dernières actualités et événements de West Paris Consulting. Restez informé de nos projets et initiatives étudiantes.">

    <!-- WPC Fonts: Satoshi via Fontshare -->
    <link href="https://api.fontshare.com/v2/css?f[]=satoshi@300,400,500,600,700,800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- WPC Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

    <link rel="stylesheet" href="style.css?v=2">
</head>

<body class="page basicpage" id="page-wpc-actualites" data-cmp-link-accessibility-enabled=""
    data-cmp-link-accessibility-text="s'ouvre dans un nouvel onglet" data-cmp-link-accessibility-enabled="">

    <div class="root container responsivegrid">

        <!-- Navigation principale -->
        <nav class="main-navigation">
            <div class="main-navigation__container">
                <div class="main-navigation__content">
                    <!-- Logo à gauche -->
                    <div class="main-navigation__logo">
                        <a href="index.html" class="main-navigation__logo-link">
                            <div class="main-navigation__logo-text" data-text="WEST PARIS&#10;CONSULTING">WEST
                                PARIS<br>CONSULTING</div>
                        </a>
                    </div>

                    <!-- Bouton hamburger mobile (caché sur desktop) -->
                    <button class="main-navigation__toggle" id="mobile-menu-toggle"
                        aria-label="Ouvrir le menu de navigation" aria-expanded="false">
                        <div class="hamburger-icon">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </div>
                    </button>

                    <!-- Liens de navigation -->
                    <div class="main-navigation__links" id="mobile-menu" role="navigation" aria-label="Menu principal">
                        <a href="index.html" class="main-navigation__link"><span>Accueil</span></a>
                        <a href="domaines.html" class="main-navigation__link"><span>Nos Domaines</span></a>
                        <a href="equipe.html" class="main-navigation__link"><span>Notre Équipe</span></a>
                        <a href="actualites.html" class="main-navigation__link"><span>Actualités</span></a>
                        <a href="contact.html" class="main-navigation__link"><span>Contact</span></a>
                        <a href="nous-rejoindre.html" class="main-navigation__link"><span>Nous rejoindre</span></a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section Actualités -->
        <div class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">Actualités</h1>
                <p class="hero-subtitle">Découvrez nos dernières publications.</p>
            </div>
        </div>

        <!-- Contenu principal -->
        <main class="main container responsivegrid aem-GridColumn aem-GridColumn--default--12">
            <div id="main-wpc-content" class="cmp-container">
                <div class="section container responsivegrid">

                    <!-- Section Actualités -->
                    <div id="section-wpc-actualites" class="cmp-container section-gray">
                        <div class="cmp-actualites-section">
                            <div class="cmp-actualites-content">
                                <!-- Les actualités seront chargées dynamiquement ici via Decap CMS -->
                                <div id="actualites-container">
                                    <!-- Contenu dynamique -->
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>

        <!-- WPC Footer -->
        <footer class="cmp-footer">
            <div class="cmp-footer__container">
                <div class="cmp-footer__content">
                    <div class="cmp-footer__links">
                        <a href="index.html">Accueil</a>
                        <a href="domaines.html">Nos Domaines</a>
                        <a href="equipe.html">Notre Équipe</a>
                        <a href="actualites.html">Actualités</a>
                        <a href="contact.html">Contact</a>
                        <a href="mentions-legales.html">Mentions légales</a>
                        <a href="confidentialite.html">Politique de Confidentialité</a>
                    </div>

                    <div class="cmp-footer__copyright">
                        <p>© 2025 West Paris Consulting, association étudiante de l'Université Paris Nanterre. Tous
                            droits réservés.</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gray-matter@4.0.3/dist/gray-matter.min.js"></script>

    <!-- Script de chargement des actualités -->
    <script>
        // Charger les actualités depuis les fichiers Markdown
        async function loadActualites() {
            const container = document.getElementById('actualites-container');

            try {
                // Récupérer la liste des fichiers
                const response = await fetch('https://api.github.com/repos/Frd100/wpc-site/contents/content/actualites');
                const files = await response.json();

                if (!Array.isArray(files) || files.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666;">Aucune actualité pour le moment.</p>';
                    return;
                }

                // Charger le contenu de chaque fichier
                const actualites = await Promise.all(
                    files
                        .filter(file => file.name.endsWith('.md'))
                        .map(async file => {
                            const contentResponse = await fetch(file.download_url);
                            const content = await contentResponse.text();
                            const parsed = parseMarkdownFile(content);
                            if (parsed) parsed.filename = file.name;
                            return parsed;
                        })
                );

                // Filtrer les actualités publiées et trier par date
                const publishedActualites = actualites
                    .filter(a => a && (a.published === true || a.published === 'true'))
                    .sort((a, b) => new Date(b.date) - new Date(a.date));

                // Afficher les actualités
                if (publishedActualites.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666;">Aucune actualité publiée pour le moment.</p>';
                    return;
                }

                container.innerHTML = `
                    <div class="articles-grid">
                        ${publishedActualites.map(actualite => {
                    const date = new Date(actualite.date).toLocaleDateString('fr-FR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    // Échapper le HTML pour éviter les injections
                    const safeTitle = escapeHtml(actualite.title);
                    const safeAuthor = escapeHtml(actualite.author);
                    const safeExcerpt = escapeHtml(actualite.excerpt);
                    const safeType = escapeHtml(actualite.type || 'Article');

                    // Utiliser l'image de bannière
                    const imageUrl = actualite.banner || 'https://via.placeholder.com/400x200/00AAF4/FFFFFF?text=Article';

                    // Convertir le Markdown en HTML
                    const htmlContent = markdownToHtml(actualite.body);

                    // Créer un slug pour l'URL
                    const slug = actualite.title
                        .toLowerCase()
                        .replace(/[^a-z0-9\s-]/g, '')
                        .replace(/\s+/g, '-')
                        .replace(/-+/g, '-')
                        .trim('-');

                    return `
                                <article class="cmp-actualite-card">
                                    <img src="${imageUrl}" alt="${safeTitle}" class="article-image" onclick="window.location.href='article.html?slug=${slug}&file=${encodeURIComponent(actualite.filename)}'" onerror="this.src='https://via.placeholder.com/400x200/00AAF4/FFFFFF?text=Article'">
                                    <div class="article-content">
                                        <div class="article-type">${safeType}</div>
                                        <h3 class="cmp-actualite-title" onclick="window.location.href='article.html?slug=${slug}&file=${encodeURIComponent(actualite.filename)}'">${safeTitle}</h3>
                                        <div class="actualite-meta">
                                            <span class="actualite-date">${date}</span>
                                        </div>
                                        <p class="cmp-actualite-excerpt">${safeExcerpt}</p>
                                    </div>
                                </article>
                            `;
                }).join('')}
                    </div>
                `;

            } catch (error) {
                console.error('Erreur lors du chargement des actualités:', error);
                container.innerHTML = '<p style="text-align: center; color: #d00;">Erreur lors du chargement des actualités.</p>';
            }
        }

        // Parser un fichier Markdown avec front matter YAML via gray-matter
        function parseMarkdownFile(content) {
            // Helper to normalize boolean 'published'
            const isPublished = (val) => {
                if (val === true) return true;
                if (typeof val === 'string') {
                    const v = val.trim().toLowerCase();
                    return v === 'true' || v === 'yes' || v === 'on';
                }
                if (typeof val === 'number') return val === 1;
                return false;
            };

            // Try gray-matter if available
            try {
                if (typeof window !== 'undefined' && typeof window.matter === 'function') {
                    const parsed = window.matter(content);
                    const data = parsed.data || {};
                    return {
                        title: data.title || 'Sans titre',
                        date: data.date || new Date().toISOString().split('T')[0],
                        author: data.author || 'Auteur inconnu',
                        excerpt: data.excerpt || '',
                        banner: data.banner || '',
                        type: data.type || 'Article',
                        body: (parsed.content || '').trim(),
                        published: isPublished(data.published)
                    };
                }
            } catch (e) {
                console.error('Erreur de parsing gray-matter:', e);
            }

            // Fallback parser (regex)
            const match = content.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
            if (!match) return null;

            const frontMatter = {};
            const lines = match[1].split('\n');
            lines.forEach(line => {
                const colonIndex = line.indexOf(':');
                if (colonIndex === -1) return;
                const key = line.substring(0, colonIndex).trim();
                let value = line.substring(colonIndex + 1).trim();
                value = value.replace(/^["']|["']$/g, '');
                frontMatter[key] = value;
            });

            return {
                title: frontMatter.title || 'Sans titre',
                date: frontMatter.date || new Date().toISOString().split('T')[0],
                author: frontMatter.author || 'Auteur inconnu',
                excerpt: frontMatter.excerpt || '',
                banner: frontMatter.banner || '',
                type: frontMatter.type || 'Article',
                body: (match[2] || '').trim(),
                published: isPublished(frontMatter.published)
            };
        }

        // Convertir Markdown en HTML
        function markdownToHtml(markdown) {
            let html = markdown;

            // Traitement des paragraphes d'abord (avant de casser avec split)
            html = html.split('\n\n').map(para => {
                para = para.trim();
                if (!para) return '';

                // Titres
                if (para.match(/^### /)) {
                    return para.replace(/^### (.*$)/gim, '<h3>$1</h3>');
                }
                if (para.match(/^## /)) {
                    return para.replace(/^## (.*$)/gim, '<h2>$1</h2>');
                }
                if (para.match(/^# /)) {
                    return para.replace(/^# (.*$)/gim, '<h1>$1</h1>');
                }

                // Séparateurs
                if (para.match(/^---$/)) {
                    return para.replace(/^---$/gim, '<hr>');
                }

                // Listes non ordonnées
                if (para.match(/^\- /)) {
                    const listItems = para.split('\n').map(item => {
                        if (item.match(/^\- /)) {
                            return item.replace(/^\- (.+)$/gim, '<li>$1</li>');
                        }
                        return item;
                    }).join('');
                    return `<ul>${listItems}</ul>`;
                }

                // Pour les autres paragraphes, traiter le contenu inline
                let processedPara = para;

                // Images Markdown
                processedPara = processedPara.replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width:100%;height:auto;">');

                // Liens Markdown
                processedPara = processedPara.replace(/\[([^\]]+)\]\(([^\)]+)\)/g, '<a href="$2">$1</a>');

                // Gras et italique
                processedPara = processedPara.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
                processedPara = processedPara.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
                processedPara = processedPara.replace(/\*(.+?)\*/g, '<em>$1</em>');

                return `<p>${processedPara}</p>`;
            }).join('\n');

            return html;
        }

        // Échapper le HTML pour éviter les injections XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Charger au chargement de la page
        document.addEventListener('DOMContentLoaded', function () {
            loadActualites();
        });
    </script>
</body>

</html>