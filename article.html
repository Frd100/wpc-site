<!DOCTYPE html>
<html lang="fr-FR" dir="ltr">

<head>
    <meta http-equiv="content-type" content="text/html" charset="UTF-8">
    <meta http-equiv="content-encoding" content="text/html">
    <meta charset="utf-8" class="chrome">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="content-language" content="fr-FR">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- WPC Meta Tags -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://westparisconsulting.fr/article.html">
    <meta property="og:title" content="Article - West Paris Consulting">
    <meta property="og:description" content="Lire l'article complet de West Paris Consulting">
    <meta property="og:site_name" content="WPC">
    <meta property="og:image" content="homepage.webp">
    <meta property="og:locale" content="fr_FR">

    <meta property="twitter:url" content="https://westparisconsulting.fr/article.html">
    <meta property="twitter:title" content="Article - West Paris Consulting">
    <meta property="twitter:description" content="Lire l'article complet de West Paris Consulting">
    <meta property="twitter:creator" content="@WestParisConsulting">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:image" content="homepage.webp">

    <title>Article - West Paris Consulting</title>
    <meta name="description" content="Lire l'article complet de West Paris Consulting">

    <!-- WPC Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- WPC Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

    <link rel="stylesheet" href="style.css?v=2">
</head>

<body class="page basicpage" id="page-wpc-article" data-cmp-link-accessibility-enabled=""
    data-cmp-link-accessibility-text="s'ouvre dans un nouvel onglet" data-cmp-data-layer-enabled="">

    <div class="root container responsivegrid">

        <!-- Navigation Placeholder -->
        <div id="nav-placeholder"></div>

        <!-- Hero Section Article -->
        <div class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title" id="article-title">Chargement...</h1>
            </div>
        </div>

        <!-- Contenu principal -->
        <main class="main container responsivegrid aem-GridColumn aem-GridColumn--default--12">
            <div id="main-wpc-content" class="cmp-container">
                <div class="section container responsivegrid">

                    <!-- Article complet -->
                    <article class="cmp-article-section">
                        <div class="cmp-article-content">
                            <div class="article-meta" id="article-meta">
                                <!-- Métadonnées de l'article -->
                            </div>
                            <div class="article-content" id="article-content">
                                <!-- Contenu de l'article -->
                            </div>
                            <div class="article-actions">
                                <a href="actualites.html" class="btn-secondary">
                                    <span class="material-icons">arrow_back</span>
                                    Retour aux actualités
                                </a>
                            </div>
                        </div>
                    </article>

                </div>
            </div>
        </main>

        <!-- WPC Footer -->
        <footer class="cmp-footer">
            <div class="cmp-footer__container">
                <div class="cmp-footer__content">
                    <div class="cmp-footer__links">
                        <a href="index.html">Accueil</a>
                        <a href="domaines.html">Nos Domaines</a>
                        <a href="equipe.html">Notre Équipe</a>
                        <a href="actualites.html">Actualités</a>
                        <a href="contact.html">Contact</a>
                        <a href="mentions-legales.html">Mentions légales</a>
                        <a href="confidentialite.html">Politique de Confidentialité</a>
                    </div>

                    <div class="cmp-footer__copyright">
                        <p>© 2025 West Paris Consulting, association étudiante de l'Université Paris Nanterre. Tous
                            droits réservés.</p>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <!-- Scripts -->
    <script src="main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gray-matter@4.0.3/dist/gray-matter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" integrity="sha384-lvMyg7Hq5p5zH2Qqz8bH0f4QZZo2YF5yI2S7o8q7n2pPZV6q2mR8vQ2XnZVb7WcJ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js" integrity="sha384-z8b4l3mKqz7E2m8M2x3m3oQ2m7qz7+GxqvK1rXq2pT9xV1Z2G3gTtJp8jv2lKfQx" crossorigin="anonymous"></script>

    <!-- Script de chargement de l'article -->
    <script>
        // Charger l'article spécifique
        async function loadArticle() {
            const urlParams = new URLSearchParams(window.location.search);
            const filename = urlParams.get('file');

            if (!filename) {
                document.getElementById('article-content').innerHTML = '<p style="text-align: center; color: #d00;">Article non trouvé.</p>';
                return;
            }

            try {
                // Charger le fichier spécifique
                const response = await fetch(`https://api.github.com/repos/Frd100/wpc-site/contents/content/actualites/${filename}`);
                const file = await response.json();

                const contentResponse = await fetch(file.download_url);
                const content = await contentResponse.text();
                const article = parseMarkdownFile(content);

                if (!article) {
                    document.getElementById('article-content').innerHTML = '<p style="text-align: center; color: #d00;">Erreur lors du chargement de l\'article.</p>';
                    return;
                }

                // Mettre à jour le titre de la page
                document.title = `${article.title} - West Paris Consulting`;
                document.getElementById('article-title').textContent = article.title;

                // Mettre à jour les métadonnées
                const date = new Date(article.date).toLocaleDateString('fr-FR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                document.getElementById('article-meta').innerHTML = `
                    <div class="article-meta-content">
                        <span class="article-date">${date}</span>
                        <span class="article-author">Par ${escapeHtml(article.author)}</span>
                    </div>
                `;

                // Mettre à jour le contenu (marked + DOMPurify si dispo)
                const rawHtml = (typeof window !== 'undefined' && window.marked)
                    ? window.marked.parse(article.body || '')
                    : markdownToHtml(article.body || '');
                const safeHtml = (typeof window !== 'undefined' && window.DOMPurify)
                    ? window.DOMPurify.sanitize(rawHtml)
                    : rawHtml;
                document.getElementById('article-content').innerHTML = safeHtml;

                // SEO dynamique
                const excerpt = article.excerpt || (article.body || '').replace(/\s+/g, ' ').slice(0, 160);
                document.title = `${article.title} - West Paris Consulting`;
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc) metaDesc.setAttribute('content', excerpt);
                const ogTitle = document.querySelector('meta[property="og:title"]');
                if (ogTitle) ogTitle.setAttribute('content', `${article.title} - West Paris Consulting`);
                const ogDesc = document.querySelector('meta[property="og:description"]');
                if (ogDesc) ogDesc.setAttribute('content', excerpt);
                const twTitle = document.querySelector('meta[property="twitter:title"]');
                if (twTitle) twTitle.setAttribute('content', `${article.title} - West Paris Consulting`);
                const twDesc = document.querySelector('meta[property="twitter:description"]');
                if (twDesc) twDesc.setAttribute('content', excerpt);

            } catch (error) {
                console.error('Erreur lors du chargement de l\'article:', error);
                document.getElementById('article-content').innerHTML = '<p style="text-align: center; color: #d00;">Erreur lors du chargement de l\'article.</p>';
            }
        }

        // Parser un fichier Markdown avec front matter YAML via gray-matter si dispo, sinon regex fallback
        function parseMarkdownFile(content) {
            try {
                if (typeof window !== 'undefined' && typeof window.matter === 'function') {
                    const parsed = window.matter(content);
                    const data = parsed.data || {};
                    return {
                        title: data.title || 'Sans titre',
                        date: data.date || new Date().toISOString().split('T')[0],
                        author: data.author || 'Auteur inconnu',
                        excerpt: data.excerpt || '',
                        body: (parsed.content || '').trim(),
                        published: data.published !== false && data.published !== 'false'
                    };
                }
            } catch (e) {
                console.error('Erreur de parsing gray-matter:', e);
            }

            const match = content.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
            if (!match) return null;

            const frontMatter = {};
            const lines = match[1].split('\n');
            lines.forEach(line => {
                const colonIndex = line.indexOf(':');
                if (colonIndex === -1) return;
                const key = line.substring(0, colonIndex).trim();
                let value = line.substring(colonIndex + 1).trim();
                value = value.replace(/^["']|["']$/g, '');
                frontMatter[key] = value;
            });

            return {
                title: frontMatter.title || 'Sans titre',
                date: frontMatter.date || new Date().toISOString().split('T')[0],
                author: frontMatter.author || 'Auteur inconnu',
                excerpt: frontMatter.excerpt || '',
                body: (match[2] || '').trim(),
                published: frontMatter.published !== false && frontMatter.published !== 'false'
            };
        }

        // Convertir Markdown en HTML
        function markdownToHtml(markdown) {
            let html = markdown;

            // Titres
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');

            // Gras et italique
            html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');

            // Listes non ordonnées
            html = html.replace(/^\- (.+)$/gim, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');

            // Séparateurs
            html = html.replace(/^---$/gim, '<hr>');

            // Paragraphes
            html = html.split('\n\n').map(para => {
                para = para.trim();
                if (para.startsWith('<h') || para.startsWith('<ul') || para.startsWith('<hr')) {
                    return para;
                }
                return para ? `<p>${para}</p>` : '';
            }).join('\n');

            return html;
        }

        // Échapper le HTML pour éviter les injections XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Charger au chargement de la page
        document.addEventListener('DOMContentLoaded', loadArticle);
    </script>
</body>

</html>